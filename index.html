<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#f8fafc" />
    <title>Minutes Taking App</title>
    <link rel="icon" href="icon-192.svg" type="image/svg+xml" />
    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <h1>Minutes Taker</h1>
        <span class="subtitle" id="currentDate">Monday, February 2, 2026</span>
      </div>
      <div class="topbar-center" id="stage1Controls">
        <label class="inline-field compact">
          <span>Session</span>
          <input id="sessionName" type="text" placeholder="e.g. Project Sync" />
        </label>
        <button id="confirmSetupBtn" class="primary">Start Session</button>
      </div>
      <div class="topbar-center" id="stage2Controls" hidden>
        <div class="rec-status-bar">
          <span id="recStatus" class="rec-badge">Idle</span>
          <span id="recTimer">00:00</span>
        </div>
        <div class="rec-speaker">
          <strong id="currentSpeaker">None</strong>
        </div>
        <div class="rec-buttons">
          <button id="startBtn" class="primary">Record</button>
          <button id="stopBtn" class="danger" disabled>Stop</button>
          <button id="replayBtn" class="ghost" disabled>Replay</button>
          <button id="exportBtn" class="ghost" disabled>Export</button>
          <button id="newSessionBtn" class="ghost-danger">New</button>
        </div>
      </div>
      <div class="topbar-right">
        <button id="historyBtn" class="icon-btn" title="Session History">
          <i data-lucide="clock"></i>
        </button>
      </div>
    </header>

    <main class="layout">
      <section class="left">
        <div class="panel canvas-panel">
          <div class="canvas-header">
            <h2>Table Mode</h2>
            <div class="canvas-hint" id="canvasHint">
              Drag a person anywhere on the board to place them.
            </div>
          </div>
          <div class="tables-controls">
            <button id="addTableBtn" class="ghost btn-add-table">Add Oval Table</button>
            <button id="addCircleBtn" class="ghost btn-add-circle">Add Circle Table</button>
            <button id="addRectBtn" class="ghost btn-add-rect">Add Rectangle Table</button>
            <button id="clearTablesBtn" class="danger">Clear Tables</button>
          </div>
          <div id="canvas" class="canvas">
            <div class="front-label">Front</div>
          </div>
        </div>
      </section>

      <aside class="right">
        <div class="panel people">
          <div class="people-header">
            <h2>People</h2>
            <p id="peopleHint">Drag onto the board. Click to log speaker (Stage 2).</p>
          </div>
          <div class="data-import" id="dataImport">
            <div class="data-import-row">
              <button id="csvPickBtn" class="ghost btn-upload-csv">Upload CSV</button>
              <button id="photosPickBtn" class="ghost btn-upload-photos">Upload Photos</button>
            </div>
            <div class="data-import-row data-import-status-stack">
              <span id="photosStatus" class="data-import-status">No photos loaded</span>
              <span id="csvStatus" class="data-import-status">No CSV loaded</span>
            </div>
            <div class="data-import-row data-import-template">
              <a id="csvTemplateLink" class="template-link" href="#">Download CSV Template</a>
              <span class="data-import-status">
                Use headers only. Name and photo_filename are required; alias is optional.
              </span>
            </div>
            <p class="data-import-note">
              The <strong>photo_filename</strong> must match the image filename exactly.
            </p>
            <input id="csvInput" type="file" accept=".csv,text/csv" hidden />
            <input id="photosInput" type="file" accept="image/*" multiple hidden />
          </div>
          <div class="guest-add" id="guestAdd">
            <input id="guestNameInput" type="text" placeholder="Add guest name" />
            <button id="addGuestBtn" class="ghost">Add</button>
          </div>
          <div id="peopleList" class="people-list"></div>
        </div>
        <div class="panel absent">
          <div class="people-header">
            <h2>Absent</h2>
            <p>Drop here to mark absent.</p>
          </div>
          <div id="absentBox" class="absent-box">
            <div id="absentList" class="absent-list"></div>
          </div>
        </div>
      </aside>
    </main>

    <div id="historyModal" class="modal" hidden>
      <div class="modal-content history-modal">
        <button class="modal-close" id="closeHistoryBtn" aria-label="Close history">
          <i data-lucide="x"></i>
        </button>
        <div class="modal-header-simple">
          <h2>Session History</h2>
        </div>
        <div class="history-list" id="historyList">
          <p class="empty-state">No saved sessions yet.</p>
        </div>
      </div>
    </div>

    <div id="replayModal" class="modal" hidden>
      <div class="modal-content replay-modal">
        <button id="closeModalBtn" class="modal-close" aria-label="Close replay">
          <i data-lucide="x"></i>
        </button>
        <div class="replay-layout">
          <div class="replay-player">
            <div class="replay-player-label">Audio</div>
            <audio id="replayAudioModal" controls></audio>
            <div class="replay-speaker-now">
              <span class="speaker-label">Speaking:</span>
              <strong id="modalCurrentSpeaker">â€”</strong>
            </div>
          </div>
          <div class="replay-timeline">
            <div class="timeline-header">Speaker Log</div>
            <div class="timeline-log" id="timelineLog"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="alertModal" class="modal" hidden>
      <div class="modal-content alert-modal">
        <button id="closeAlertBtn" class="modal-close" aria-label="Close alert">
          <i data-lucide="x"></i>
        </button>
        <div class="alert-header">
          <span id="alertBadge" class="alert-badge">Info</span>
          <h2 id="alertTitle">Alert</h2>
        </div>
        <ul id="alertMessages" class="alert-messages"></ul>
      </div>
    </div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="app.js"></script>
  </body>
</html>
